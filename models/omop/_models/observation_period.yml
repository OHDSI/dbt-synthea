models:
  - name: observation_period
    description: >-
      This table contains records which define spans of time during which two conditions are
      expected to hold: 
        - (i) Clinical Events that happened to the Person are recorded in the Event tables, and 
        - (ii) absence of records indicate such Events did not occur during this span of time.

      ## User Guide

      For each Person, one or more OBSERVATION_PERIOD records may be present, but they will not
      overlap or be back to back to each other.  Events may exist outside all of the time spans of
      the OBSERVATION_PERIOD records for a patient, however, absence of an Event outside  these time
      spans cannot be construed as evidence of absence of an Event.  Incidence or prevalence rates
      should only be calculated for the time of active OBSERVATION_PERIOD records.  When
      constructing cohorts, outside Events can be used for inclusion criteria definition, but
      without any guarantee for the performance of these criteria.  Also, OBSERVATION_PERIOD records
      can be as short as a single day, greatly disturbing the denominator of any rate calculation as
      part of cohort characterizations.  To avoid that, apply minimal observation time as a
      requirement for any cohort definition.

    columns:
      - name: observation_period_id
        data_type: integer
        description:
          A Person can have multiple discrete Observation Periods which are identified by the
          Observation_Period_Id.
        tests:
          - unique
          - not_null
      - name: person_id
        data_type: integer
        description:
          The Person ID of the PERSON record for which the Observation Period is recorded.
        tests:
          - not_null
          - relationships:
              field: person_id
              to: ref('person')
      - name: observation_period_start_date
        description: Use this date to determine the start date of the Observation Period.
        data_type: date
        tests:
          - not_null
      - name: observation_period_end_date
        description:
          Use this date to determine the end date of the period for which we can assume that all
          events for a Person are recorded.
        data_type: date
        tests:
          - not_null
      - name: period_type_concept_id
        description:
          This field can be used to determine the provenance of the Observation Period as in whether
          the period was determined from an insurance enrollment file, EHR healthcare encounters, or
          other sources.
        data_type: integer
        tests:
          - not_null
          - dbt_utils.relationships_where:
              field: concept_id
              to: ref('concept')
              from_condition: period_type_concept_id <> 0
              to_condition: domain_id = 'Type Concept'
